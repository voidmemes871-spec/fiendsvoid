<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BENITEZ SHOP - Login y Tienda</title>

<!-- Favicon -->
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1170/1170576.png" type="image/png" />

<!-- Bootstrap CSS y Boxicons -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<style>
  /* Fuente y base */
  * {
    font-family: 'Poppins', sans-serif;
  }
  body {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, #07f4ff , #1c1e1e);
  }

  /* Login Container */
  #login-container {
  background: #189471ac; /* Fondo negro */
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 90vh;
  transition: opacity 0.5s ease;
}


  #login-box {
    background: rgba(0,0,0,0.75);
    border-radius: 12px;
    width: 350px;
    padding: 25px 35px;
    color: white;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }
  #login-box header {
    font-size: 32px;
    text-align: center;
    margin-bottom: 25px;
    font-weight: 700;
    letter-spacing: 1.5px;
  }

  .input-field {
    position: relative;
    margin-bottom: 20px;
  }
  .input-field input {
    width: 100%;
    height: 48px;
    border-radius: 30px;
    border: none;
    outline: none;
    padding-left: 45px;
    background: rgba(255,255,255,0.15);
    color: #fff;
    font-size: 16px;
    transition: background-color 0.3s ease;
  }
  .input-field input:focus {
    background: rgba(255,255,255,0.3);
  }
  .input-field input::placeholder {
    color: #ddd;
  }
  .input-field i {
    position: absolute;
    top: 14px;
    left: 15px;
    font-size: 20px;
    color: #aaa;
    transition: color 0.3s ease;
  }
  .input-field input:focus + i {
    color: #07f4ff;
  }

  .submit {
    width: 100%;
    border: none;
    border-radius: 30px;
    background: #07f4ff;
    height: 48px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    font-weight: 600;
    color: #111;
    box-shadow: 0 4px 10px rgba(7, 244, 255, 0.6);
  }
  .submit:hover {
    background-color: #04c8d6;
    box-shadow: 0 8px 16px rgba(4, 200, 214, 0.7);
  }

  .bottom {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    margin-top: 15px;
  }
  .bottom a {
    color: #07f4ff;
    text-decoration: none;
    font-weight: 500;
  }
  .bottom a:hover {
    text-decoration: underline;
  }
  .bottom label {
    display: flex;
    align-items: center;
    color: #fff;
    font-weight: 500;
  }
  .bottom input[type="checkbox"] {
    margin-right: 8px;
    cursor: pointer;
  }

  /* Tienda */
  #store-container {
    display: none;
    padding: 20px;
    transition: opacity 0.5s ease;
  }
  h1.store-title {
    color: #07f4ff;
    text-align: center;
    margin-bottom: 30px;
    font-weight: 700;
    letter-spacing: 2px;
    font-size: 2.5rem;
  }

  .card {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }
  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.45);
  }
  .card img {
    height: 200px;
    object-fit: cover;
    transition: transform 0.4s ease;
  }
  .card:hover img {
    transform: scale(1.05);
  }
  .card-body {
    background: #111;
    color: white;
  }
  .card-title {
    font-weight: 700;
    font-size: 1.25rem;
  }
  .card-text {
    font-size: 1.1rem;
    color: #07f4ff;
  }
  .btn-primary {
    background-color: #07f4ff;
    border-color: #07f4ff;
    font-weight: 600;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  .btn-primary:hover {
    background-color: #04c8d6;
    border-color: #04c8d6;
    box-shadow: 0 8px 20px rgba(4, 200, 214, 0.7);
  }

  /* Botón mostrar carrito */
  #show-cart-btn {
    display: block;
    margin: 30px auto 0;
    padding: 12px 25px;
    font-size: 18px;
  }

  /* Modal */
  .modal-content {
    background-color: #111;
    color: white;
    border-radius: 12px;
  }
  .modal-header, .modal-footer {
    border: none;
  }
  .modal-title {
    color: #07f4ff;
    font-weight: 700;
  }
  .close {
    color: white;
    opacity: 1;
  }
  .close:hover {
    color: #07f4ff;
  }
  .table thead th {
    border-bottom: 2px solid #07f4ff;
  }
  .table tbody td {
    vertical-align: middle;
  }
  .btn-danger {
    background-color: #ff4c4c;
    border-color: #ff4c4c;
    font-weight: 600;
  }
  .btn-danger:hover {
    background-color: #e63939;
    border-color: #e63939;
  }
  .text-right {
    text-align: right;
  }

  /* Responsive */
  @media (max-width: 768px) {
    #login-box {
      width: 90vw;
      padding: 20px;
    }
    .card {
      margin-bottom: 20px;
    }
    #show-cart-btn {
      width: 90%;
      font-size: 16px;
      padding: 10px;
    }
  }

  @media (max-width: 480px) {
    .card img {
      height: 150px;
    }
    .card-title {
      font-size: 1.1rem;
    }
    .btn-primary {
      font-size: 14px;
      padding: 8px 14px;
    }
  }

  /* Animaciones */
  .fade-in {
    animation: fadeIn ease 0.7s;
  }
  @keyframes fadeIn {
    0% {opacity: 0;}
    100% {opacity: 1;}
  }

  /* Perfil y pedidos */
  #profile-container {
    display: none;
    color: white;
    padding: 20px;
  }
  #profile-container h2 {
    margin-bottom: 20px;
    color: #07f4ff;
  }
  #profile-container ul {
    list-style: none;
    padding: 0;
  }
  #profile-container li {
    background: #222;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 8px;
  }

  /* Formulario método de pago */
  .payment-methods input[type="text"], 
  .payment-methods input[type="number"], 
  .payment-methods input[type="month"] {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: none;
    outline: none;
    font-size: 16px;
  }
  .payment-methods label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
    color: #07f4ff;
  }
  .payment-error {
    color: #ff4c4c;
    margin-bottom: 15px;
    font-weight: 700;
  }
  .payment-success {
    color: #4BB543;
    font-weight: 700;
    margin-top: 10px;
    text-align: center;
  }

</style>
</head>
<body>

<!-- Login -->
<div id="login-container" class="fade-in">
  <div id="login-box">
    <span>BENITEZ SHOP--COMPRAS INSANAS</span>
    <header>Iniciar sesión</header>
    <form id="login-form" novalidate>
      <div class="input-field">
        <input type="text" id="username" placeholder="USUARIO" required autocomplete="off" />
        <i class='bx bx-user'></i>
      </div>
      <div class="input-field">
        <input type="password" id="password" placeholder="CONTRASEÑA" required autocomplete="off" />
        <i class='bx bx-lock-alt'></i>
      </div>
      <input type="submit" class="submit" value="Iniciar" />
      <div class="bottom">
        <label><input type="checkbox" id="remember" /> Recordarme</label>
        <a href="#">¿Olvidaste tu contraseña?</a>
      </div>
      <p id="login-error" style="color:#ff4c4c; text-align:center; margin-top:10px; display:none;"></p>
    </form>
  </div>
</div>

<!-- Tienda -->
<div id="store-container" class="container mt-5 fade-in">
  <h1 class="store-title">BENITEZ SHOP</h1>
  <div class="row" id="product-list"></div>
  <button id="show-cart-btn" class="btn btn-primary" data-toggle="modal" data-target="#cartModal">Mostrar Carrito</button>
  <button id="show-profile-btn" class="btn btn-secondary mt-3" style="display:none;">Ver Perfil y Pedidos</button>
</div>

<!-- Perfil y Pedidos -->
<div id="profile-container" class="container mt-5 fade-in">
  <h2>Perfil de Usuario</h2>
  <p><strong>Usuario:</strong> <span id="profile-username"></span></p>
  <h3>Historial de Pedidos</h3>
  <ul id="order-history">
    <!-- Pedidos se insertan aquí -->
  </ul>
  <button id="back-to-store-btn" class="btn btn-primary mt-3">Volver a la Tienda</button>
</div>

<!-- Modal Carrito -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cartModalLabel">Contenido del Carrito</h5>
        <button type="button" class="close" id="close-cart" aria-label="Cerrar">
          <span aria-hidden="true" style="color:#fff;">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-dark table-hover">
          <thead>
            <tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th><th>Eliminar</th></tr>
          </thead>
          <tbody id="cart-content"></tbody>
        </table>
        <h5 class="text-right">Total: $<span id="cart-total">0.00</span></h5>
        <button id="checkout-btn" class="btn btn-success btn-block mt-3" ${'disabled'}>Proceder al Pago</button>
        <p id="checkout-error" style="color:#ff4c4c; text-align:center; margin-top:10px; display:none;"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="close-cart-footer">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Método de Pago -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-md">
    <div class="modal-content payment-methods">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel">Método de Pago</h5>
        <button type="button" class="close" id="close-payment" aria-label="Cerrar">
          <span aria-hidden="true" style="color:#fff;">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="payment-form" novalidate>
          <label for="payment-type">Selecciona método de pago:</label>
          <select id="payment-type" required>
            <option value="">-- Seleccione --</option>
            <option value="tarjeta">Tarjeta de Crédito/Débito</option>
            <option value="paypal">PayPal</option>
            <option value="transferencia">Transferencia Bancaria</option>
          </select>

          <div id="payment-details" style="margin-top:15px;">
            <!-- Campos dinámicos aquí -->
          </div>

          <p id="payment-error" class="payment-error" style="display:none;"></p>
          <button type="submit" class="btn btn-primary btn-block mt-3">Pagar Ahora</button>
          <p id="payment-success" class="payment-success" style="display:none;">Pago realizado con éxito. ¡Gracias por su compra!</p>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Datos de usuario para login simulado
  const usersDB = [
    { username: "admin", password: "1234" },
    { username: "usuario", password: "password" }
  ];

  // Productos (completos)
  const products = [
    { id: 1, name: 'Avion', price: 200000.00, img: 'https://th.bing.com/th/id/R.b6f563cfcedffffcba171caaa2e41d62?rik=%2bLEXvPsbd7c%2frw&pid=ImgRaw&r=0' },
    { id: 2, name: 'RTX 4090', price: 200.00, img: 'https://tse1.mm.bing.net/th/id/OIP.CG7eCbw6I1ePaUs64qEWPwHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 3, name: 'Ryzen 5', price: 30.00, img: 'https://tse1.mm.bing.net/th/id/OIP.5Zyrat-7gAEkCRp1xP9GegHaFj?pid=Api&P=0&h=180.jpg' },
    { id: 4, name: 'Chetos FH', price: 40.00, img: 'https://tse2.mm.bing.net/th/id/OIP.qa21NdoIBRvhfSx5u5fuBgHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 5, name: 'XBOX SERIES S', price: 5000.00, img: 'https://tse1.mm.bing.net/th/id/OIP.hKG5Rr41g2z5oOZpNj4ojgHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 6, name: 'PC Gamer', price: 60000.00, img: 'https://tse2.mm.bing.net/th/id/OIP.o9q4-YQjijbaUyRIFJrrpQHaHn?pid=Api&P=0&h=180.jpg' },
    { id: 7, name: 'Tarjeta Madre', price: 70.00, img: 'https://tse4.mm.bing.net/th/id/OIP.ybEhIC1LrVnv6Dv3p4FWuQHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 8, name: 'Refrigeracion Liquida', price: 80.00, img: 'https://tse4.mm.bing.net/th/id/OIP.hBHBwPwpObDpDb0GjyhXFQHaEK?pid=Api&P=0&h=180.jpg' },
    { id: 9, name: 'Case PC Gamer', price: 90.00, img: 'https://tse4.mm.bing.net/th/id/OIP.pnQv1tAK8D5iDOUWao-DRgHaH3?pid=Api&P=0&h=180.jpg' },
    { id: 10, name: 'Teclado Gamer Ryzer', price: 100.00, img: 'https://tse2.mm.bing.net/th/id/OIP.AR2vMlJ-8tHQMhtJ4-9ZcQHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 11, name: 'Pasta Termica', price: 110.00, img: 'https://tse4.mm.bing.net/th/id/OIP.bl09wuHpDFwpPnmav86JbQHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 12, name: 'Mouse Razer', price: 120.00, img: 'https://sp.yimg.com/ib/th?id=OPHS.a6mtLs3ohDmGhw474C474&o=5&pid=21.1&w=160&h=105.png' },
    { id: 13, name: 'AULA A, BACHO 4', price: 130.00, img: 'https://tse1.mm.bing.net/th/id/OIP.sl3a-Q7Ql1uWjsx3zVjoiwHaFj?pid=Api&P=0&h=180.png' },
    { id: 14, name: 'Laptop Acer ASPIRE', price: 140.00, img: 'https://tse1.mm.bing.net/th/id/OIP.N6gAvBoFbikeI5XL4sd_8AHaEM?pid=Api&P=0&h=180.jpg' },
    { id: 15, name: 'ITALIKA DM 300', price: 150.00, img: 'https://sp.yimg.com/ib/th/id/OIP.toUfzwds116atw-WNXTaQgHaHa?pid=Api&w=148&h=148&c=7&dpr=2&rs=1' },
    { id: 16, name: 'Monitor 240HZ', price: 160.00, img: 'https://sp.yimg.com/ib/th?id=OPHS.rFadk%2bNFRHBIhQ474C474&o=5&pid=21.1&w=160&h=105.jpg' },
    { id: 17, name: 'Hamburguesa', price: 170.00, img: 'https://tse1.mm.bing.net/th/id/OIP.WLhdS82_ez8toZqN-BSoMwHaGY?pid=Api&P=0&h=180.png' },
    { id: 19, name: 'Ceviche de Camaron', price: 190.00, img: 'https://tse1.mm.bing.net/th/id/OIP.g19N_YtlhHmO4rlsUD9HwAHaHa?pid=Api&P=0&h=180.jpg' },
    { id: 20, name: 'Escritorio Gamer', price: 200.00, img: 'https://sp.yimg.com/ib/th?id=OPHS.%2f%2fzQ92IcIS43Dw474C474&o=5&pid=21.1&w=160&h=105.jpg' },
  ];

  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  let currentUser = null;
  let orders = JSON.parse(localStorage.getItem('orders')) || [];

  function saveCart() {
    localStorage.setItem('cart', JSON.stringify(cart));
  }
  function saveOrders() {
    localStorage.setItem('orders', JSON.stringify(orders));
  }

  // Render productos
  function renderProducts() {
    const productList = document.getElementById('product-list');
    productList.innerHTML = '';
    products.forEach(product => {
      const productCard = `
        <div class="col-md-3 mb-4">
          <div class="card" title="${product.name}">
            <img src="${product.img}" class="card-img-top" alt="${product.name}">
            <div class="card-body">
              <h5 class="card-title">${product.name}</h5>
              <p class="card-text">$${product.price.toFixed(2)}</p>
              <button class="btn btn-primary" onclick="addToCart(${product.id})">Agregar al Carrito</button>
            </div>
          </div>
        </div>`;
      productList.insertAdjacentHTML('beforeend', productCard);
    });
    updateCartModal();
  }

  // Añadir producto al carrito
  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    const cartItem = cart.find(item => item.id === productId);
    if (cartItem) {
      cartItem.quantity++;
    } else {
      cart.push({ ...product, quantity: 1 });
    }
    saveCart();
    updateCartModal();
    alert(`"${product.name}" agregado al carrito.`);
  }

  // Actualizar modal carrito
  function updateCartModal() {
    const cartContent = document.getElementById('cart-content');
    const cartTotal = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    cartContent.innerHTML = '';
    let total = 0;
    if(cart.length === 0) {
      cartContent.innerHTML = `<tr><td colspan="5" class="text-center">El carrito está vacío.</td></tr>`;
      checkoutBtn.disabled = true;
      cartTotal.innerText = '0.00';
      return;
    }
    cart.forEach(item => {
      const itemTotal = item.price * item.quantity;
      total += itemTotal;
      const cartRow = `
        <tr>
          <td>${item.name}</td>
          <td>
            <input type="number" min="1" value="${item.quantity}" style="width: 60px;" onchange="changeQuantity(${item.id}, this.value)" />
          </td>
          <td>$${item.price.toFixed(2)}</td>
          <td>$${itemTotal.toFixed(2)}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="removeFromCart(${item.id})" title="Eliminar producto">
              <i class='bx bx-trash'></i>
            </button>
          </td>
        </tr>`;
      cartContent.insertAdjacentHTML('beforeend', cartRow);
    });
    cartTotal.innerText = total.toFixed(2);
    checkoutBtn.disabled = false;
  }

  // Cambiar cantidad
  function changeQuantity(productId, quantity) {
    quantity = parseInt(quantity);
    if(quantity <= 0 || isNaN(quantity)) return;
    const cartItem = cart.find(item => item.id === productId);
    if(cartItem) {
      cartItem.quantity = quantity;
      saveCart();
      updateCartModal();
    }
  }

  // Eliminar producto del carrito
  function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    saveCart();
    updateCartModal();
  }

  // Manejar login con validación real simple
  document.getElementById('login-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const usernameInput = document.getElementById('username').value.trim();
    const passwordInput = document.getElementById('password').value.trim();
    const loginError = document.getElementById('login-error');

    const user = usersDB.find(u => u.username === usernameInput && u.password === passwordInput);
    if(user) {
      currentUser = user;
      loginError.style.display = 'none';
      document.getElementById('login-container').style.display = 'none';
      document.getElementById('store-container').style.display = 'block';
      document.getElementById('show-profile-btn').style.display = 'inline-block';
      renderProducts();
      document.getElementById('profile-username').innerText = currentUser.username;
    } else {
      loginError.innerText = 'Usuario o contraseña incorrectos.';
      loginError.style.display = 'block';
    }
  });

  // Botones cerrar modal carrito
  document.getElementById('close-cart').addEventListener('click', () => $('#cartModal').modal('hide'));
  document.getElementById('close-cart-footer').addEventListener('click', () => $('#cartModal').modal('hide'));

  // Botón proceder a pago
  document.getElementById('checkout-btn').addEventListener('click', () => {
    if(cart.length === 0) {
      alert('El carrito está vacío. Agrega productos para continuar.');
      return;
    }
    $('#cartModal').modal('hide');
    openPaymentModal();
  });

  // Abrir modal de pago
  function openPaymentModal() {
    document.getElementById('payment-error').style.display = 'none';
    document.getElementById('payment-success').style.display = 'none';
    document.getElementById('payment-form').reset();
    document.getElementById('payment-details').innerHTML = '';
    $('#paymentModal').modal('show');
  }

  // Cerrar modal pago
  document.getElementById('close-payment').addEventListener('click', () => {
    $('#paymentModal').modal('hide');
  });

  // Cambiar campos según método pago
  document.getElementById('payment-type').addEventListener('change', function() {
    const val = this.value;
    const detailsDiv = document.getElementById('payment-details');
    detailsDiv.innerHTML = '';
    if(val === 'tarjeta') {
      detailsDiv.innerHTML = `
        <label for="card-number">Número de Tarjeta:</label>
        <input type="text" id="card-number" maxlength="19" placeholder="1234 5678 9012 3456" required pattern="\\d{13,19}" autocomplete="off" />
        <label for="card-expiry">Fecha de Expiración:</label>
        <input type="month" id="card-expiry" required />
        <label for="card-cvv">CVV:</label>
        <input type="text" id="card-cvv" maxlength="4" placeholder="123" required pattern="\\d{3,4}" autocomplete="off" />
      `;
    } else if(val === 'paypal') {
      detailsDiv.innerHTML = `
        <label for="paypal-email">Correo de PayPal:</label>
        <input type="email" id="paypal-email" placeholder="usuario@ejemplo.com" required />
      `;
    } else if(val === 'transferencia') {
      detailsDiv.innerHTML = `
        <label for="bank-account">Número de Cuenta Bancaria:</label>
        <input type="text" id="bank-account" placeholder="000123456789" required pattern="\\d{8,20}" />
        <label for="bank-name">Nombre del Banco:</label>
        <input type="text" id="bank-name" placeholder="Banco Ejemplo" required />
      `;
    }
  });

  // Validar y procesar pago
  document.getElementById('payment-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const paymentType = document.getElementById('payment-type').value;
    const errorP = document.getElementById('payment-error');
    const successP = document.getElementById('payment-success');
    errorP.style.display = 'none';
    successP.style.display = 'none';

    if(!paymentType) {
      errorP.innerText = 'Por favor, selecciona un método de pago.';
      errorP.style.display = 'block';
      return;
    }

    // Validación básica
    let valid = true;

    if(paymentType === 'tarjeta') {
      const cardNumber = document.getElementById('card-number').value.replace(/\s+/g, '');
      const cardExpiry = document.getElementById('card-expiry').value;
      const cardCVV = document.getElementById('card-cvv').value;

      if(!/^\d{13,19}$/.test(cardNumber)) {
        valid = false;
        errorP.innerText = 'Número de tarjeta inválido.';
      } else if(!cardExpiry) {
        valid = false;
        errorP.innerText = 'Selecciona fecha de expiración.';
      } else if(!/^\d{3,4}$/.test(cardCVV)) {
        valid = false;
        errorP.innerText = 'CVV inválido.';
      }

    } else if(paymentType === 'paypal') {
      const paypalEmail = document.getElementById('paypal-email').value;
      if(!paypalEmail || !/\S+@\S+\.\S+/.test(paypalEmail)) {
        valid = false;
        errorP.innerText = 'Correo PayPal inválido.';
      }

    } else if(paymentType === 'transferencia') {
      const bankAccount = document.getElementById('bank-account').value;
      const bankName = document.getElementById('bank-name').value;
      if(!bankAccount || !/^\d{8,20}$/.test(bankAccount)) {
        valid = false;
        errorP.innerText = 'Número de cuenta bancaria inválido.';
      } else if(!bankName) {
        valid = false;
        errorP.innerText = 'Nombre del banco es requerido.';
      }
    }

    if(!valid) {
      errorP.style.display = 'block';
      return;
    }

    // Si pasa validación simular pago exitoso
    successP.style.display = 'block';
    // Guardar pedido
    const order = {
      user: currentUser.username,
      items: [...cart],
      total: cart.reduce((acc, i) => acc + i.price * i.quantity, 0),
      date: new Date().toLocaleString()
    };
    orders.push(order);
    saveOrders();
    // Vaciar carrito
    cart = [];
    saveCart();
    updateCartModal();

    // Cerrar modal pago luego de 2.5 segundos
    setTimeout(() => {
      $('#paymentModal').modal('hide');
      alert('¡Compra realizada con éxito! Gracias por preferir BENITEZ SHOP.');
      showProfile();
    }, 2500);
  });

  // Mostrar perfil y pedidos
  const profileBtn = document.getElementById('show-profile-btn');
  profileBtn.addEventListener('click', showProfile);

  function showProfile() {
    document.getElementById('store-container').style.display = 'none';
    document.getElementById('profile-container').style.display = 'block';
    renderOrders();
  }

  document.getElementById('back-to-store-btn').addEventListener('click', () => {
    document.getElementById('profile-container').style.display = 'none';
    document.getElementById('store-container').style.display = 'block';
  });

  // Render historial pedidos
  function renderOrders() {
    const ordersList = document.getElementById('order-history');
    ordersList.innerHTML = '';

    const userOrders = orders.filter(o => o.user === currentUser.username);
    if(userOrders.length === 0) {
      ordersList.innerHTML = '<li>No tienes pedidos realizados aún.</li>';
      return;
    }

    userOrders.forEach(order => {
      let itemsHTML = '<ul>';
      order.items.forEach(item => {
        itemsHTML += `<li>${item.name} x ${item.quantity} — $${(item.price*item.quantity).toFixed(2)}</li>`;
      });
      itemsHTML += '</ul>';
      const orderHTML = `
        <li>
          <strong>Fecha:</strong> ${order.date}<br/>
          <strong>Total:</strong> $${order.total.toFixed(2)}
          ${itemsHTML}
        </li>`;
      ordersList.insertAdjacentHTML('beforeend', orderHTML);
    });
  }
</script>

</body>
</html>
